substitutions:
  devicename: watermeter
  upper_devicename: Watermeter

esphome:
  name: $devicename
  platform: ESP8266
  board: d1_mini

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  manual_ip:
    static_ip: !secret watermeter_static_ip
    gateway: !secret gateway
    subnet: !secret subnet 

  ap:
    ssid: !secret watermeter_ap_ssid
    password: !secret watermeter_ap_ssid

captive_portal:

logger:

api:
  password: !secret watermeter_api_password

ota:
  password: !secret watermeter_ota_password

globals:
  - id: totalWaterUsage
    type: float
    restore_value: yes       # When updating below value, change this to no for 1 run.
    initial_value: '224.458' # 24-4-2021 12:00

sensor:
  - platform: pulse_counter
    pin: D4
    id: watermeter_pulse
    name: ${upper_devicename} pulse
    update_interval: 1s
    unit_of_measurement: L
    filters:
      - multiply: 0.016666667
  
  - platform: template
    id: watermeter_total
    name: ${upper_devicename} totaal
    icon: mdi:water
    update_interval: 1s
    unit_of_measurement: mÂ³
    accuracy_decimals: 3
    lambda: |-
      if (id(watermeter_pulse).state >= 1) {
        id(totalWaterUsage) += 0.001;
      }
      return id(totalWaterUsage);
  
  - platform: wifi_signal
    id: ${devicename}_esphome_wifi_signal
    name: ${upper_devicename} wifi signaal
    update_interval: 10s

  - platform: uptime
    id: ${devicename}_esphome_uptime
    name: ${upper_devicename} uptime

switch:
  - platform: restart
    id: ${devicename}_esphome_restart
    name: ${upper_devicename} herstart

text_sensor:
  - platform: version
    id: ${devicename}_esphome_version
    name: ${upper_devicename} version
